// Main logic for the dashboard
document.addEventListener('DOMContentLoaded', () => {
    // --- 1. CORE RENDERING FUNCTION ---
    const renderDashboard = (platform) => {
        const data = mockData[platform];
        if (!data) return;

        // A. Update KPI Cards
        document.getElementById('total-reach').textContent = formatNumber(data.totalReach);
        document.getElementById('engagement-rate').textContent = `${data.engagementRate.toFixed(2)}%`;
        document.getElementById('sentiment-score').textContent = data.sentimentScore;
        document.getElementById('total-posts').textContent = data.totalPosts;

        // B. Update Change Indicators
        updateChangeIndicator('reach', data.change.reach, formatNumber(Math.abs(data.change.reach)) + '%');
        updateChangeIndicator('engagement', data.change.engagement, `${Math.abs(data.change.engagement).toFixed(2)}%`);
        updateChangeIndicator('sentiment', data.change.sentiment, Math.abs(data.change.sentiment));
        updateChangeIndicator('posts', data.change.posts, Math.abs(data.change.posts));

        // C. Render Simple Bar Chart
        renderSimpleChart(data.trend, 'reach-chart');
    };

    // Helper function to update the change indicator style
    const updateChangeIndicator = (key, changeValue, text) => {
        const element = document.getElementById(`${key}-change`);
        element.textContent = (changeValue > 0 ? '+' : (changeValue < 0 ? '-' : '')) + text;
        
        element.classList.remove('positive', 'negative');
        if (changeValue > 0) {
            element.classList.add('positive');
        } else if (changeValue < 0) {
            element.classList.add('negative');
        }
    };

    // Helper function to render a simple CSS bar chart
    const renderSimpleChart = (trendData, containerId) => {
        const container = document.getElementById(containerId);
        container.innerHTML = ''; // Clear previous bars
        
        // Find the maximum value to scale all bars relative to the tallest one
        const maxVal = Math.max(...trendData); 

        trendData.forEach(value => {
            const bar = document.createElement('div');
            bar.classList.add('bar');
            // Calculate height as a percentage of the max value
            const heightPercent = (value / maxVal) * 100;
            bar.style.height = `${heightPercent}%`;
            
            // Optional: Add tooltip/label for value
            bar.setAttribute('title', formatNumber(value)); 

            container.appendChild(bar);
        });
    };


    // --- 2. EVENT LISTENERS ---

    // A. Platform Filtering
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove 'active' class from all buttons
            filterButtons.forEach(btn => btn.classList.remove('active'));
            // Add 'active' class to the clicked button
            this.classList.add('active'); 

            const platform = this.getAttribute('data-platform');
            renderDashboard(platform);
        });
    });

    // B. Theme Toggle
    document.getElementById('theme-toggle').addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        document.getElementById('theme-toggle').innerHTML = isDark ? 'üåô Toggle Light Mode' : '‚òÄÔ∏è Toggle Dark Mode';
    });

    // --- 3. INITIAL LOAD ---
    // Load the dashboard with the 'all' platform data on startup
    renderDashboard('all'); 
});